<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tile Picker - LimeZu Modern Interiors</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #b5a589;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        label {
            font-weight: 500;
            color: #b5a589;
        }

        select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #2a2a4a;
            color: #eee;
            font-size: 14px;
            cursor: pointer;
        }

        select:hover {
            border-color: #b5a589;
        }

        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .tileset-container {
            flex: 1;
            min-width: 400px;
            background: #2a2a4a;
            border-radius: 8px;
            padding: 15px;
            overflow: auto;
            max-height: 70vh;
        }

        .tileset-info {
            margin-bottom: 10px;
            font-size: 12px;
            color: #888;
        }

        .tileset-wrapper {
            position: relative;
            display: inline-block;
            cursor: crosshair;
        }

        .tileset-image {
            display: block;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .hover-highlight {
            position: absolute;
            border: 2px solid #ffcc00;
            background: rgba(255, 204, 0, 0.2);
            pointer-events: none;
            display: none;
        }

        .selection-overlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .selection-panel {
            width: 380px;
            background: #2a2a4a;
            border-radius: 8px;
            padding: 20px;
        }

        .selection-panel h2 {
            color: #b5a589;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .selection-header h2 {
            margin-bottom: 0;
        }

        .clear-selection-btn {
            padding: 6px 12px;
            background: #663333;
            border: none;
            border-radius: 3px;
            color: #eee;
            font-size: 12px;
            cursor: pointer;
        }

        .clear-selection-btn:hover {
            background: #884444;
        }

        .selected-tiles-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: #1a1a2e;
            border-radius: 4px;
        }

        .selected-tile-item {
            width: 48px;
            height: 48px;
            background: #2a2a4a;
            border: 2px solid #00ff88;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }

        .selected-tile-item:hover {
            border-color: #ff4444;
        }

        .selected-tile-item:hover::after {
            content: '×';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #ff4444;
            text-shadow: 0 0 4px #000;
        }

        .selected-tile-item canvas {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            width: 100%;
            height: 100%;
        }

        .tile-number {
            position: absolute;
            bottom: 2px;
            right: 2px;
            background: rgba(0,0,0,0.7);
            color: #fff;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 2px;
        }

        .code-section {
            margin-top: 15px;
        }

        .code-section h3 {
            font-size: 14px;
            color: #888;
            margin-bottom: 8px;
        }

        .code-box {
            background: #1a1a2e;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 12px;
            padding-right: 70px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            color: #88ff88;
            word-break: break-all;
            position: relative;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 4px 10px;
            background: #444;
            border: none;
            border-radius: 3px;
            color: #eee;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #666;
        }

        .copy-btn.copied {
            background: #00aa55;
        }

        .no-selection {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 40px 20px;
        }

        .coordinates-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }

        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            padding: 10px;
            background: #1a1a2e;
            border-radius: 4px;
        }

        .format-select {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Tile Picker</h1>

    <div class="controls">
        <div class="control-group">
            <label for="tilesetSelect">Tileset:</label>
            <select id="tilesetSelect">
                <option value="floors">Room Builder - Floors</option>
                <option value="walls">Room Builder - Walls</option>
                <option value="generic">1 - Generic</option>
                <option value="livingRoom">2 - Living Room</option>
                <option value="bedroom">4 - Bedroom</option>
                <option value="conference">13 - Conference Hall</option>
            </select>
        </div>
        <div class="control-group">
            <label for="scaleSelect">Scale:</label>
            <select id="scaleSelect">
                <option value="2">2x</option>
                <option value="3" selected>3x</option>
                <option value="4">4x</option>
                <option value="6">6x</option>
            </select>
        </div>
    </div>

    <div class="main-container">
        <div class="tileset-container">
            <div class="tileset-info" id="tilesetInfo">Loading...</div>
            <div class="tileset-wrapper" id="tilesetWrapper">
                <img class="tileset-image" id="tilesetImage" src="" alt="Tileset">
                <canvas class="grid-overlay" id="gridOverlay"></canvas>
                <canvas class="selection-overlay" id="selectionOverlay"></canvas>
                <div class="hover-highlight" id="hoverHighlight"></div>
            </div>
        </div>

        <div class="selection-panel">
            <div class="selection-header">
                <h2>Selected Tiles (<span id="selectionCount">0</span>)</h2>
                <button class="clear-selection-btn" id="clearSelection">Clear All</button>
            </div>

            <div class="selected-tiles-grid" id="selectedTilesGrid">
                <div class="no-selection">Click tiles to select. Click again to deselect.</div>
            </div>

            <div class="code-section">
                <div class="format-select">
                    <label for="formatSelect">Format:</label>
                    <select id="formatSelect">
                        <option value="array">Array of objects</option>
                        <option value="const">Named constants</option>
                        <option value="compact">Compact array</option>
                    </select>
                </div>
                <h3>Code Output</h3>
                <div class="code-box" id="codeBox">
                    <code id="codeSnippet">// Select tiles to generate code</code>
                    <button class="copy-btn" id="copyBtn">Copy</button>
                </div>
            </div>

            <div class="help-text">
                <strong>Tips:</strong><br>
                • Click to select/deselect tiles<br>
                • Click selected tiles in the grid to remove them<br>
                • Tiles are numbered in selection order
            </div>
        </div>
    </div>

    <div class="coordinates-display" id="coordsDisplay">Move cursor over tileset</div>

    <script>
        const TILESETS = {
            floors: { path: '/assets/tiles/Room_Builder_Floors_16x16.png', name: 'Floors' },
            walls: { path: '/assets/tiles/Room_Builder_Walls_16x16.png', name: 'Walls' },
            generic: { path: '/assets/tiles/1_Generic_16x16.png', name: 'Generic' },
            livingRoom: { path: '/assets/tiles/2_LivingRoom_16x16.png', name: 'Living Room' },
            bedroom: { path: '/assets/tiles/4_Bedroom_16x16.png', name: 'Bedroom' },
            conference: { path: '/assets/tiles/13_Conference_Hall_16x16.png', name: 'Conference Hall' }
        };

        const TILE_SIZE = 16;
        let currentTileset = 'floors';
        let currentScale = 3;
        let currentImage = null;
        let selectedTiles = []; // Array of selected tiles
        let tilesetImages = {}; // Cache loaded images

        const elements = {
            tilesetSelect: document.getElementById('tilesetSelect'),
            scaleSelect: document.getElementById('scaleSelect'),
            formatSelect: document.getElementById('formatSelect'),
            tilesetImage: document.getElementById('tilesetImage'),
            tilesetWrapper: document.getElementById('tilesetWrapper'),
            gridOverlay: document.getElementById('gridOverlay'),
            selectionOverlay: document.getElementById('selectionOverlay'),
            hoverHighlight: document.getElementById('hoverHighlight'),
            tilesetInfo: document.getElementById('tilesetInfo'),
            selectedTilesGrid: document.getElementById('selectedTilesGrid'),
            selectionCount: document.getElementById('selectionCount'),
            codeSnippet: document.getElementById('codeSnippet'),
            codeBox: document.getElementById('codeBox'),
            copyBtn: document.getElementById('copyBtn'),
            clearSelection: document.getElementById('clearSelection'),
            coordsDisplay: document.getElementById('coordsDisplay')
        };

        function loadTileset(tilesetKey) {
            const tileset = TILESETS[tilesetKey];
            if (!tileset) return;

            currentTileset = tilesetKey;
            elements.tilesetInfo.textContent = 'Loading...';
            elements.tilesetImage.style.display = 'none';

            const img = new Image();
            img.onload = () => {
                currentImage = img;
                tilesetImages[tilesetKey] = img;
                const scaledWidth = img.width * currentScale;
                const scaledHeight = img.height * currentScale;

                elements.tilesetImage.src = img.src;
                elements.tilesetImage.style.width = scaledWidth + 'px';
                elements.tilesetImage.style.height = scaledHeight + 'px';
                elements.tilesetImage.style.display = 'block';

                const tilesX = Math.floor(img.width / TILE_SIZE);
                const tilesY = Math.floor(img.height / TILE_SIZE);
                elements.tilesetInfo.textContent =
                    `${tileset.name} - ${img.width}x${img.height}px (${tilesX}x${tilesY} tiles)`;

                drawGrid(scaledWidth, scaledHeight);
                drawSelectionOverlay();
            };
            img.onerror = () => {
                elements.tilesetInfo.textContent = 'Failed to load tileset';
            };
            img.src = tileset.path;
        }

        function drawGrid(width, height) {
            const canvas = elements.gridOverlay;
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');

            ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.lineWidth = 1;

            const scaledTileSize = TILE_SIZE * currentScale;

            for (let x = 0; x <= width; x += scaledTileSize) {
                ctx.beginPath();
                ctx.moveTo(x + 0.5, 0);
                ctx.lineTo(x + 0.5, height);
                ctx.stroke();
            }

            for (let y = 0; y <= height; y += scaledTileSize) {
                ctx.beginPath();
                ctx.moveTo(0, y + 0.5);
                ctx.lineTo(width, y + 0.5);
                ctx.stroke();
            }
        }

        function drawSelectionOverlay() {
            if (!currentImage) return;

            const scaledWidth = currentImage.width * currentScale;
            const scaledHeight = currentImage.height * currentScale;
            const canvas = elements.selectionOverlay;
            canvas.width = scaledWidth;
            canvas.height = scaledHeight;
            const ctx = canvas.getContext('2d');

            ctx.clearRect(0, 0, scaledWidth, scaledHeight);

            const scaledTileSize = TILE_SIZE * currentScale;

            selectedTiles.forEach((tile, index) => {
                if (tile.tileset !== currentTileset) return;

                const x = tile.tileX * scaledTileSize;
                const y = tile.tileY * scaledTileSize;

                // Draw selection highlight
                ctx.fillStyle = 'rgba(0, 255, 136, 0.3)';
                ctx.fillRect(x, y, scaledTileSize, scaledTileSize);

                ctx.strokeStyle = '#00ff88';
                ctx.lineWidth = 2;
                ctx.strokeRect(x + 1, y + 1, scaledTileSize - 2, scaledTileSize - 2);

                // Draw number
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(x + 2, y + 2, 16, 14);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 10px monospace';
                ctx.fillText((index + 1).toString(), x + 4, y + 12);
            });
        }

        function getTileCoords(event) {
            const rect = elements.tilesetWrapper.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const scaledTileSize = TILE_SIZE * currentScale;

            return {
                tileX: Math.floor(x / scaledTileSize),
                tileY: Math.floor(y / scaledTileSize),
                pixelX: Math.floor(x / scaledTileSize) * scaledTileSize,
                pixelY: Math.floor(y / scaledTileSize) * scaledTileSize
            };
        }

        function updateHoverHighlight(coords) {
            const scaledTileSize = TILE_SIZE * currentScale;
            elements.hoverHighlight.style.display = 'block';
            elements.hoverHighlight.style.left = coords.pixelX + 'px';
            elements.hoverHighlight.style.top = coords.pixelY + 'px';
            elements.hoverHighlight.style.width = scaledTileSize + 'px';
            elements.hoverHighlight.style.height = scaledTileSize + 'px';

            elements.coordsDisplay.textContent = `tileX: ${coords.tileX}, tileY: ${coords.tileY}`;
        }

        function toggleTile(coords) {
            const existingIndex = selectedTiles.findIndex(t =>
                t.tileset === currentTileset &&
                t.tileX === coords.tileX &&
                t.tileY === coords.tileY
            );

            if (existingIndex !== -1) {
                // Deselect
                selectedTiles.splice(existingIndex, 1);
            } else {
                // Select
                selectedTiles.push({
                    tileset: currentTileset,
                    tileX: coords.tileX,
                    tileY: coords.tileY
                });
            }

            drawSelectionOverlay();
            updateSelectionPanel();
            updateCodeOutput();
        }

        function removeTile(index) {
            selectedTiles.splice(index, 1);
            drawSelectionOverlay();
            updateSelectionPanel();
            updateCodeOutput();
        }

        function updateSelectionPanel() {
            elements.selectionCount.textContent = selectedTiles.length;

            if (selectedTiles.length === 0) {
                elements.selectedTilesGrid.innerHTML = '<div class="no-selection">Click tiles to select. Click again to deselect.</div>';
                return;
            }

            elements.selectedTilesGrid.innerHTML = '';

            selectedTiles.forEach((tile, index) => {
                const div = document.createElement('div');
                div.className = 'selected-tile-item';
                div.title = `${tile.tileset} (${tile.tileX}, ${tile.tileY}) - Click to remove`;

                const canvas = document.createElement('canvas');
                canvas.width = TILE_SIZE;
                canvas.height = TILE_SIZE;

                // Load and draw the tile
                const loadAndDraw = () => {
                    const img = tilesetImages[tile.tileset];
                    if (img) {
                        const ctx = canvas.getContext('2d');
                        ctx.imageSmoothingEnabled = false;
                        ctx.drawImage(
                            img,
                            tile.tileX * TILE_SIZE,
                            tile.tileY * TILE_SIZE,
                            TILE_SIZE, TILE_SIZE,
                            0, 0, TILE_SIZE, TILE_SIZE
                        );
                    }
                };

                if (tilesetImages[tile.tileset]) {
                    loadAndDraw();
                } else {
                    const img = new Image();
                    img.onload = () => {
                        tilesetImages[tile.tileset] = img;
                        loadAndDraw();
                    };
                    img.src = TILESETS[tile.tileset].path;
                }

                const number = document.createElement('div');
                number.className = 'tile-number';
                number.textContent = (index + 1).toString();

                div.appendChild(canvas);
                div.appendChild(number);
                div.addEventListener('click', () => removeTile(index));

                elements.selectedTilesGrid.appendChild(div);
            });
        }

        function updateCodeOutput() {
            if (selectedTiles.length === 0) {
                elements.codeSnippet.textContent = '// Select tiles to generate code';
                return;
            }

            const format = elements.formatSelect.value;
            let code = '';

            switch (format) {
                case 'array':
                    code = 'const TILES = [\n';
                    selectedTiles.forEach((tile, i) => {
                        code += `    { tileset: '${tile.tileset}', tileX: ${tile.tileX}, tileY: ${tile.tileY} }`;
                        code += i < selectedTiles.length - 1 ? ',\n' : '\n';
                    });
                    code += '];';
                    break;

                case 'const':
                    selectedTiles.forEach((tile, i) => {
                        code += `const TILE_${i + 1} = { tileset: '${tile.tileset}', tileX: ${tile.tileX}, tileY: ${tile.tileY} };\n`;
                    });
                    break;

                case 'compact':
                    code = '[';
                    selectedTiles.forEach((tile, i) => {
                        code += `['${tile.tileset}',${tile.tileX},${tile.tileY}]`;
                        code += i < selectedTiles.length - 1 ? ',' : '';
                    });
                    code += ']';
                    break;
            }

            elements.codeSnippet.textContent = code;
        }

        // Event listeners
        elements.tilesetSelect.addEventListener('change', (e) => {
            loadTileset(e.target.value);
        });

        elements.scaleSelect.addEventListener('change', (e) => {
            currentScale = parseInt(e.target.value);
            loadTileset(currentTileset);
        });

        elements.formatSelect.addEventListener('change', () => {
            updateCodeOutput();
        });

        elements.tilesetWrapper.addEventListener('mousemove', (e) => {
            const coords = getTileCoords(e);
            updateHoverHighlight(coords);
        });

        elements.tilesetWrapper.addEventListener('mouseleave', () => {
            elements.hoverHighlight.style.display = 'none';
            elements.coordsDisplay.textContent = 'Move cursor over tileset';
        });

        elements.tilesetWrapper.addEventListener('click', (e) => {
            const coords = getTileCoords(e);
            toggleTile(coords);
        });

        elements.clearSelection.addEventListener('click', () => {
            selectedTiles = [];
            drawSelectionOverlay();
            updateSelectionPanel();
            updateCodeOutput();
        });

        elements.copyBtn.addEventListener('click', () => {
            const code = elements.codeSnippet.textContent;
            navigator.clipboard.writeText(code).then(() => {
                elements.copyBtn.textContent = 'Copied!';
                elements.copyBtn.classList.add('copied');
                setTimeout(() => {
                    elements.copyBtn.textContent = 'Copy';
                    elements.copyBtn.classList.remove('copied');
                }, 1500);
            });
        });

        // Initialize
        loadTileset('floors');
    </script>
</body>
</html>
