<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tile Picker - LimeZu Modern Interiors</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #b5a589;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        label {
            font-weight: 500;
            color: #b5a589;
        }

        select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #444;
            background: #2a2a4a;
            color: #eee;
            font-size: 14px;
            cursor: pointer;
        }

        select:hover {
            border-color: #b5a589;
        }

        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .tileset-container {
            flex: 1;
            min-width: 400px;
            background: #2a2a4a;
            border-radius: 8px;
            padding: 15px;
            overflow: auto;
            max-height: 70vh;
        }

        .tileset-info {
            margin-bottom: 10px;
            font-size: 12px;
            color: #888;
        }

        .tileset-wrapper {
            position: relative;
            display: inline-block;
            cursor: crosshair;
        }

        .tileset-image {
            display: block;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .hover-highlight {
            position: absolute;
            border: 2px solid #ffcc00;
            background: rgba(255, 204, 0, 0.2);
            pointer-events: none;
            display: none;
        }

        .selected-highlight {
            position: absolute;
            border: 3px solid #00ff88;
            background: rgba(0, 255, 136, 0.3);
            pointer-events: none;
            display: none;
        }

        .selection-panel {
            width: 320px;
            background: #2a2a4a;
            border-radius: 8px;
            padding: 20px;
        }

        .selection-panel h2 {
            color: #b5a589;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .preview-container {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            margin-bottom: 20px;
        }

        .preview-box {
            width: 96px;
            height: 96px;
            background: #1a1a2e;
            border: 2px solid #444;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .preview-box canvas {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .preview-info {
            flex: 1;
        }

        .info-row {
            margin-bottom: 8px;
        }

        .info-label {
            font-size: 12px;
            color: #888;
        }

        .info-value {
            font-size: 16px;
            font-weight: 500;
            color: #fff;
        }

        .code-section {
            margin-top: 20px;
        }

        .code-section h3 {
            font-size: 14px;
            color: #888;
            margin-bottom: 8px;
        }

        .code-box {
            background: #1a1a2e;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            color: #88ff88;
            word-break: break-all;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 4px 10px;
            background: #444;
            border: none;
            border-radius: 3px;
            color: #eee;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .copy-btn:hover {
            background: #666;
        }

        .copy-btn.copied {
            background: #00aa55;
        }

        .no-selection {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 40px 20px;
        }

        .coordinates-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }

        .history-section {
            margin-top: 20px;
            border-top: 1px solid #444;
            padding-top: 15px;
        }

        .history-section h3 {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
        }

        .history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .history-item {
            width: 48px;
            height: 48px;
            background: #1a1a2e;
            border: 2px solid #444;
            border-radius: 4px;
            cursor: pointer;
            overflow: hidden;
            transition: border-color 0.2s;
        }

        .history-item:hover {
            border-color: #b5a589;
        }

        .history-item canvas {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            width: 100%;
            height: 100%;
        }

        .clear-history {
            margin-top: 10px;
            padding: 6px 12px;
            background: #444;
            border: none;
            border-radius: 3px;
            color: #eee;
            font-size: 12px;
            cursor: pointer;
        }

        .clear-history:hover {
            background: #666;
        }
    </style>
</head>
<body>
    <h1>Tile Picker</h1>

    <div class="controls">
        <div class="control-group">
            <label for="tilesetSelect">Tileset:</label>
            <select id="tilesetSelect">
                <option value="floors">Room Builder - Floors</option>
                <option value="walls">Room Builder - Walls</option>
                <option value="generic">1 - Generic</option>
                <option value="livingRoom">2 - Living Room</option>
                <option value="bedroom">4 - Bedroom</option>
                <option value="conference">13 - Conference Hall</option>
            </select>
        </div>
        <div class="control-group">
            <label for="scaleSelect">Scale:</label>
            <select id="scaleSelect">
                <option value="2">2x</option>
                <option value="3" selected>3x</option>
                <option value="4">4x</option>
                <option value="6">6x</option>
            </select>
        </div>
    </div>

    <div class="main-container">
        <div class="tileset-container">
            <div class="tileset-info" id="tilesetInfo">Loading...</div>
            <div class="tileset-wrapper" id="tilesetWrapper">
                <img class="tileset-image" id="tilesetImage" src="" alt="Tileset">
                <canvas class="grid-overlay" id="gridOverlay"></canvas>
                <div class="hover-highlight" id="hoverHighlight"></div>
                <div class="selected-highlight" id="selectedHighlight"></div>
            </div>
        </div>

        <div class="selection-panel">
            <h2>Selected Tile</h2>
            <div id="selectionContent">
                <div class="no-selection">Click a tile to select it</div>
            </div>

            <div class="history-section">
                <h3>Recent Selections</h3>
                <div class="history-list" id="historyList"></div>
                <button class="clear-history" id="clearHistory">Clear History</button>
            </div>
        </div>
    </div>

    <div class="coordinates-display" id="coordsDisplay">Move cursor over tileset</div>

    <script>
        const TILESETS = {
            floors: { path: '/assets/tiles/Room_Builder_Floors_16x16.png', name: 'Floors' },
            walls: { path: '/assets/tiles/Room_Builder_Walls_16x16.png', name: 'Walls' },
            generic: { path: '/assets/tiles/1_Generic_16x16.png', name: 'Generic' },
            livingRoom: { path: '/assets/tiles/2_LivingRoom_16x16.png', name: 'Living Room' },
            bedroom: { path: '/assets/tiles/4_Bedroom_16x16.png', name: 'Bedroom' },
            conference: { path: '/assets/tiles/13_Conference_Hall_16x16.png', name: 'Conference Hall' }
        };

        const TILE_SIZE = 16;
        let currentTileset = 'floors';
        let currentScale = 3;
        let currentImage = null;
        let selectedTile = null;
        let history = [];

        const elements = {
            tilesetSelect: document.getElementById('tilesetSelect'),
            scaleSelect: document.getElementById('scaleSelect'),
            tilesetImage: document.getElementById('tilesetImage'),
            tilesetWrapper: document.getElementById('tilesetWrapper'),
            gridOverlay: document.getElementById('gridOverlay'),
            hoverHighlight: document.getElementById('hoverHighlight'),
            selectedHighlight: document.getElementById('selectedHighlight'),
            tilesetInfo: document.getElementById('tilesetInfo'),
            selectionContent: document.getElementById('selectionContent'),
            coordsDisplay: document.getElementById('coordsDisplay'),
            historyList: document.getElementById('historyList'),
            clearHistory: document.getElementById('clearHistory')
        };

        function loadTileset(tilesetKey) {
            const tileset = TILESETS[tilesetKey];
            if (!tileset) return;

            currentTileset = tilesetKey;
            elements.tilesetInfo.textContent = 'Loading...';
            elements.tilesetImage.style.display = 'none';

            const img = new Image();
            img.onload = () => {
                currentImage = img;
                const scaledWidth = img.width * currentScale;
                const scaledHeight = img.height * currentScale;

                elements.tilesetImage.src = img.src;
                elements.tilesetImage.style.width = scaledWidth + 'px';
                elements.tilesetImage.style.height = scaledHeight + 'px';
                elements.tilesetImage.style.display = 'block';

                const tilesX = Math.floor(img.width / TILE_SIZE);
                const tilesY = Math.floor(img.height / TILE_SIZE);
                elements.tilesetInfo.textContent =
                    `${tileset.name} - ${img.width}x${img.height}px (${tilesX}x${tilesY} tiles)`;

                drawGrid(scaledWidth, scaledHeight);
                updateSelectedHighlight();
            };
            img.onerror = () => {
                elements.tilesetInfo.textContent = 'Failed to load tileset';
            };
            img.src = tileset.path;
        }

        function drawGrid(width, height) {
            const canvas = elements.gridOverlay;
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');

            ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.lineWidth = 1;

            const scaledTileSize = TILE_SIZE * currentScale;

            // Vertical lines
            for (let x = 0; x <= width; x += scaledTileSize) {
                ctx.beginPath();
                ctx.moveTo(x + 0.5, 0);
                ctx.lineTo(x + 0.5, height);
                ctx.stroke();
            }

            // Horizontal lines
            for (let y = 0; y <= height; y += scaledTileSize) {
                ctx.beginPath();
                ctx.moveTo(0, y + 0.5);
                ctx.lineTo(width, y + 0.5);
                ctx.stroke();
            }
        }

        function getTileCoords(event) {
            const rect = elements.tilesetWrapper.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const scaledTileSize = TILE_SIZE * currentScale;

            return {
                tileX: Math.floor(x / scaledTileSize),
                tileY: Math.floor(y / scaledTileSize),
                pixelX: Math.floor(x / scaledTileSize) * scaledTileSize,
                pixelY: Math.floor(y / scaledTileSize) * scaledTileSize
            };
        }

        function updateHoverHighlight(coords) {
            const scaledTileSize = TILE_SIZE * currentScale;
            elements.hoverHighlight.style.display = 'block';
            elements.hoverHighlight.style.left = coords.pixelX + 'px';
            elements.hoverHighlight.style.top = coords.pixelY + 'px';
            elements.hoverHighlight.style.width = scaledTileSize + 'px';
            elements.hoverHighlight.style.height = scaledTileSize + 'px';

            elements.coordsDisplay.textContent = `tileX: ${coords.tileX}, tileY: ${coords.tileY}`;
        }

        function updateSelectedHighlight() {
            if (!selectedTile || selectedTile.tileset !== currentTileset) {
                elements.selectedHighlight.style.display = 'none';
                return;
            }

            const scaledTileSize = TILE_SIZE * currentScale;
            elements.selectedHighlight.style.display = 'block';
            elements.selectedHighlight.style.left = (selectedTile.tileX * scaledTileSize) + 'px';
            elements.selectedHighlight.style.top = (selectedTile.tileY * scaledTileSize) + 'px';
            elements.selectedHighlight.style.width = scaledTileSize + 'px';
            elements.selectedHighlight.style.height = scaledTileSize + 'px';
        }

        function selectTile(coords) {
            selectedTile = {
                tileset: currentTileset,
                tileX: coords.tileX,
                tileY: coords.tileY
            };

            // Add to history (avoid duplicates)
            const existingIndex = history.findIndex(h =>
                h.tileset === selectedTile.tileset &&
                h.tileX === selectedTile.tileX &&
                h.tileY === selectedTile.tileY
            );
            if (existingIndex !== -1) {
                history.splice(existingIndex, 1);
            }
            history.unshift({ ...selectedTile });
            if (history.length > 12) history.pop();

            updateSelectedHighlight();
            updateSelectionPanel();
            updateHistoryPanel();
        }

        function updateSelectionPanel() {
            if (!selectedTile || !currentImage) {
                elements.selectionContent.innerHTML = '<div class="no-selection">Click a tile to select it</div>';
                return;
            }

            const previewCanvas = document.createElement('canvas');
            previewCanvas.width = 64;
            previewCanvas.height = 64;
            const ctx = previewCanvas.getContext('2d');
            ctx.imageSmoothingEnabled = false;

            ctx.drawImage(
                currentImage,
                selectedTile.tileX * TILE_SIZE,
                selectedTile.tileY * TILE_SIZE,
                TILE_SIZE, TILE_SIZE,
                0, 0, 64, 64
            );

            const codeSnippet = `{ tileset: '${selectedTile.tileset}', tileX: ${selectedTile.tileX}, tileY: ${selectedTile.tileY} }`;

            elements.selectionContent.innerHTML = `
                <div class="preview-container">
                    <div class="preview-box" id="previewBox"></div>
                    <div class="preview-info">
                        <div class="info-row">
                            <div class="info-label">Tileset</div>
                            <div class="info-value">${selectedTile.tileset}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">Position</div>
                            <div class="info-value">X: ${selectedTile.tileX}, Y: ${selectedTile.tileY}</div>
                        </div>
                    </div>
                </div>
                <div class="code-section">
                    <h3>Code Snippet</h3>
                    <div class="code-box">
                        <code id="codeSnippet">${codeSnippet}</code>
                        <button class="copy-btn" id="copyBtn">Copy</button>
                    </div>
                </div>
            `;

            document.getElementById('previewBox').appendChild(previewCanvas);

            document.getElementById('copyBtn').addEventListener('click', () => {
                navigator.clipboard.writeText(codeSnippet).then(() => {
                    const btn = document.getElementById('copyBtn');
                    btn.textContent = 'Copied!';
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.textContent = 'Copy';
                        btn.classList.remove('copied');
                    }, 1500);
                });
            });
        }

        function updateHistoryPanel() {
            elements.historyList.innerHTML = '';

            history.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.title = `${item.tileset} (${item.tileX}, ${item.tileY})`;

                const canvas = document.createElement('canvas');
                canvas.width = TILE_SIZE;
                canvas.height = TILE_SIZE;

                // Load the tileset image for this history item
                const img = new Image();
                img.onload = () => {
                    const ctx = canvas.getContext('2d');
                    ctx.imageSmoothingEnabled = false;
                    ctx.drawImage(
                        img,
                        item.tileX * TILE_SIZE,
                        item.tileY * TILE_SIZE,
                        TILE_SIZE, TILE_SIZE,
                        0, 0, TILE_SIZE, TILE_SIZE
                    );
                };
                img.src = TILESETS[item.tileset].path;

                div.appendChild(canvas);
                div.addEventListener('click', () => {
                    if (item.tileset !== currentTileset) {
                        elements.tilesetSelect.value = item.tileset;
                        loadTileset(item.tileset);
                    }
                    selectedTile = { ...item };
                    updateSelectedHighlight();
                    updateSelectionPanel();
                });

                elements.historyList.appendChild(div);
            });
        }

        // Event listeners
        elements.tilesetSelect.addEventListener('change', (e) => {
            loadTileset(e.target.value);
        });

        elements.scaleSelect.addEventListener('change', (e) => {
            currentScale = parseInt(e.target.value);
            loadTileset(currentTileset);
        });

        elements.tilesetWrapper.addEventListener('mousemove', (e) => {
            const coords = getTileCoords(e);
            updateHoverHighlight(coords);
        });

        elements.tilesetWrapper.addEventListener('mouseleave', () => {
            elements.hoverHighlight.style.display = 'none';
            elements.coordsDisplay.textContent = 'Move cursor over tileset';
        });

        elements.tilesetWrapper.addEventListener('click', (e) => {
            const coords = getTileCoords(e);
            selectTile(coords);
        });

        elements.clearHistory.addEventListener('click', () => {
            history = [];
            updateHistoryPanel();
        });

        // Initialize
        loadTileset('floors');
    </script>
</body>
</html>
